{% extends 'base.html' %}
{% block title %}Explore Events | Uapfy{% endblock %}
{% block content %}

<div class="min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header Section -->
        <div class="text-center mb-12">
            <div class="inline-flex items-center px-4 py-2 rounded-full bg-gradient-to-r from-blue-500 to-indigo-500 text-white text-sm font-medium mb-4 shadow-lg">
                <i class="fas fa-calendar-star mr-2"></i> Discover Amazing Events
            </div>
            <h1 class="text-5xl font-bold bg-gradient-to-r from-blue-800 to-indigo-700 bg-clip-text text-transparent mb-4">
                Explore Events
            </h1>
            <p class="text-xl text-gray-600 max-w-2xl mx-auto">
                Find your next unforgettable experience from hundreds of events happening near you
            </p>
        </div>

        <!-- Search and Filter Section -->
        <div class="bg-white rounded-2xl shadow-2xl p-6 mb-8 border border-gray-100">
            <form method="GET" action="{% url 'event_view' %}" class="space-y-6">
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-4">
                    <!-- Search Input -->
                    <div class="lg:col-span-2 relative">
                        <div class="absolute inset-y-0 left-0 flex items-center pl-4 pointer-events-none">
                            <i class="fas fa-search text-gray-400"></i>
                        </div>
                        <input type="text" 
                               name="q"
                               value="{{ request.GET.q }}"
                               placeholder="Search events, categories, or locations..."
                               class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-300 shadow-sm">
                    </div>
                    
                    <!-- Category Filter -->
                    <select name="category" class="px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-300 bg-white shadow-sm">
                        <option value="">All Categories</option>
                        <option value="music" {% if request.GET.category == 'music' %}selected{% endif %}>Music</option>
                        <option value="sports" {% if request.GET.category == 'sports' %}selected{% endif %}>Sports</option>
                        <option value="arts" {% if request.GET.category == 'arts' %}selected{% endif %}>Arts & Culture</option>
                        <option value="business" {% if request.GET.category == 'business' %}selected{% endif %}>Business</option>
                        <option value="food" {% if request.GET.category == 'food' %}selected{% endif %}>Food & Drink</option>
                        <option value="tech" {% if request.GET.category == 'tech' %}selected{% endif %}>Technology</option>
                    </select>
                    
                    <!-- Date Filter -->
                    <input type="date" 
                           name="date" 
                           value="{{ request.GET.date }}"
                           class="px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-300 shadow-sm">
                </div>
                
                <!-- Advanced Filters -->
                <div class="flex flex-wrap gap-3 justify-between items-center">
                    <div class="flex flex-wrap gap-3">
                        <button type="submit" class="flex items-center px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-xl hover:from-blue-600 hover:to-indigo-600 transition duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                            <i class="fas fa-search mr-2"></i> Search Events
                        </button>
                        
                        <a href="{% url 'event_view' %}" class="flex items-center px-6 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition duration-300 shadow-sm">
                            <i class="fas fa-redo mr-2"></i> Reset
                        </a>
                        
                        <button type="button" id="location-btn" class="flex items-center px-6 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition duration-300 shadow-sm">
                            <i class="fas fa-map-marker-alt mr-2"></i> Near Me
                        </button>
                    </div>
                    
                    <select name="sort" class="px-4 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition duration-300 focus:outline-none shadow-sm">
                        <option value="">Sort By</option>
                        <option value="date_asc" {% if request.GET.sort == 'date_asc' %}selected{% endif %}>Date (Earliest)</option>
                        <option value="date_desc" {% if request.GET.sort == 'date_desc' %}selected{% endif %}>Date (Latest)</option>
                        <option value="price_low" {% if request.GET.sort == 'price_low' %}selected{% endif %}>Price (Low to High)</option>
                        <option value="price_high" {% if request.GET.sort == 'price_high' %}selected{% endif %}>Price (High to Low)</option>
                        <option value="popular" {% if request.GET.sort == 'popular' %}selected{% endif %}>Most Popular</option>
                    </select>
                </div>

                <!-- Active Filters -->
                {% if request.GET.q or request.GET.category or request.GET.date %}
                <div class="mt-4 pt-4 border-t border-gray-200">
                    <div class="flex items-center flex-wrap gap-2">
                        <span class="text-sm text-gray-600">Active filters:</span>
                        {% if request.GET.q %}
                        <span class="bg-blue-100 text-blue-700 text-sm px-3 py-1 rounded-full flex items-center shadow-sm">
                            Search: "{{ request.GET.q }}"
                            <a href="?{% for key, value in request.GET.items %}{% if key != 'q' %}{{ key }}={{ value }}{% if not forloop.last %}&{% endif %}{% endif %}{% endfor %}" class="ml-2 hover:text-blue-900">
                                <i class="fas fa-times"></i>
                            </a>
                        </span>
                        {% endif %}
                        {% if request.GET.category %}
                        <span class="bg-green-100 text-green-700 text-sm px-3 py-1 rounded-full flex items-center shadow-sm">
                            Category: {{ request.GET.category|title }}
                            <a href="?{% for key, value in request.GET.items %}{% if key != 'category' %}{{ key }}={{ value }}{% if not forloop.last %}&{% endif %}{% endif %}{% endfor %}" class="ml-2 hover:text-green-900">
                                <i class="fas fa-times"></i>
                            </a>
                        </span>
                        {% endif %}
                        {% if request.GET.date %}
                        <span class="bg-purple-100 text-purple-700 text-sm px-3 py-1 rounded-full flex items-center shadow-sm">
                            Date: {{ request.GET.date }}
                            <a href="?{% for key, value in request.GET.items %}{% if key != 'date' %}{{ key }}={{ value }}{% if not forloop.last %}&{% endif %}{% endif %}{% endfor %}" class="ml-2 hover:text-purple-900">
                                <i class="fas fa-times"></i>
                            </a>
                        </span>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            </form>
        </div>

        <!-- Results Info -->
        {% if request.GET.q or request.GET.category or request.GET.date %}
        <div class="mb-6 bg-white rounded-xl p-4 shadow-sm border border-gray-100">
            <p class="text-gray-600">
                Found <span class="font-semibold text-blue-600">{{ events.count }}</span> event{{ events.count|pluralize }} 
                {% if request.GET.q %}matching "{{ request.GET.q }}"{% endif %}
            </p>
        </div>
        {% endif %}

        <!-- Events Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-12">
            {% for event in events %}
            <div class="group bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2 border border-gray-100 overflow-hidden">
                <!-- Event Image -->
                <div class="relative h-48 overflow-hidden">
                    {% if event.banner %}
                    <img src="{{ event.banner.url }}" alt="{{ event.title }}" 
                         class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">
                    {% else %}
                    <div class="w-full h-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center">
                        <i class="fas fa-calendar-alt text-6xl text-white opacity-80"></i>
                    </div>
                    {% endif %}
                    
                    <!-- Status Badge -->
                    <div class="absolute top-3 right-3">
                        {% if event.status == 'Live' %}
                        <span class="bg-gradient-to-r from-green-500 to-emerald-500 text-white text-xs uppercase font-bold rounded-full px-3 py-1 shadow-lg">
                            <i class="fas fa-circle mr-1 text-xs"></i> {{ event.status }}
                        </span>
                        {% elif event.status == 'Upcoming' %}
                        <span class="bg-gradient-to-r from-blue-500 to-indigo-500 text-white text-xs uppercase font-bold rounded-full px-3 py-1 shadow-lg">
                            <i class="fas fa-clock mr-1 text-xs"></i> {{ event.status }}
                        </span>
                        {% else %}
                        <span class="bg-gradient-to-r from-gray-500 to-gray-600 text-white text-xs uppercase font-bold rounded-full px-3 py-1 shadow-lg">
                            {{ event.status }}
                        </span>
                        {% endif %}
                    </div>
                    
                    <!-- Featured Badge -->
                    {% if event.featured %}
                    <div class="absolute top-3 left-3">
                        <span class="bg-gradient-to-r from-yellow-500 to-amber-500 text-white text-xs font-bold rounded-full px-3 py-1 shadow-lg">
                            <i class="fas fa-star mr-1"></i> Featured
                        </span>
                    </div>
                    {% endif %}
                    
                    <!-- Gradient Overlay -->
                    <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                </div>

                <!-- Event Content -->
                <div class="p-5">
                    <!-- Categories -->
                    <div class="flex flex-wrap gap-2 mb-3">
                        {% for category in event.categories.all %}
                        <span class="bg-blue-50 text-blue-700 text-xs font-medium px-3 py-1 rounded-full border border-blue-200 shadow-sm">
                            {{ category }}
                        </span>
                        {% endfor %}
                    </div>

                    <!-- Title -->
                    <h3 class="text-lg font-bold text-gray-800 mb-2 line-clamp-2 group-hover:text-blue-700 transition-colors duration-300">
                        {{ event.title }}
                    </h3>

                    <!-- Event Details -->
                    <div class="space-y-2 mb-4">
                        <div class="flex items-center text-gray-600">
                            <i class="fas fa-map-marker-alt w-4 text-blue-500 mr-3"></i>
                            <span class="text-sm truncate">{{ event.location }}</span>
                        </div>
                        
                        <div class="flex items-center text-gray-600">
                            <i class="far fa-clock w-4 text-blue-500 mr-3"></i>
                            <span class="text-sm">{{ event.start_time|date:"M d, Y" }}</span>
                        </div>
                        
                        {% if event.price %}
                        <div class="flex items-center text-gray-600">
                            <i class="fas fa-tag w-4 text-blue-500 mr-3"></i>
                            <span class="text-sm font-semibold text-green-600">${{ event.price }}</span>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Description -->
                    <p class="text-gray-600 text-sm mb-5 line-clamp-2 leading-relaxed">
                        {{ event.description|truncatechars:120 }}
                    </p>

                    <!-- Action Button -->
                    <a href="{% url 'event_detail' event.id %}"
                       class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-medium py-3 px-4 rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 flex items-center justify-center group/btn">
                        <i class="fas fa-ticket-alt mr-2 group-hover/btn:scale-110 transition-transform"></i>
                        View Details
                    </a>
                </div>
            </div>
            {% empty %}
            <!-- Empty State -->
            <div class="col-span-full text-center py-16">
                <div class="max-w-md mx-auto">
                    <div class="w-24 h-24 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg">
                        <i class="fas fa-calendar-times text-4xl text-blue-500"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">
                        {% if request.GET.q %}No Events Found{% else %}No Events Available{% endif %}
                    </h3>
                    <p class="text-gray-600 mb-6">
                        {% if request.GET.q %}
                        We couldn't find any events matching "{{ request.GET.q }}". Try adjusting your search or filters.
                        {% else %}
                        There are no events available at the moment. Please check back later.
                        {% endif %}
                    </p>
                    {% if request.GET.q %}
                    <a href="{% url 'event_view' %}" class="bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-medium py-3 px-6 rounded-xl transition duration-300 transform hover:-translate-y-1 inline-flex items-center shadow-lg">
                        <i class="fas fa-redo mr-2"></i> View All Events
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Newsletter Section -->
        <div class="bg-gradient-to-r from-blue-600 to-indigo-700 rounded-2xl shadow-2xl p-8 text-white mb-12 relative overflow-hidden">
            <!-- Background Pattern -->
            <div class="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -translate-y-32 translate-x-32"></div>
            <div class="absolute bottom-0 left-0 w-48 h-48 bg-white/10 rounded-full translate-y-24 -translate-x-24"></div>
            
            <div class="max-w-2xl mx-auto text-center relative z-10">
                <h2 class="text-3xl font-bold mb-4">Never Miss an Event</h2>
                <p class="text-blue-100 text-lg mb-6">Subscribe to our newsletter and get updates on the best events in your area</p>
                <div class="flex flex-col sm:flex-row gap-4 max-w-md mx-auto">
                    <input type="email" 
                           placeholder="Enter your email"
                           class="flex-1 px-4 py-3 rounded-xl text-gray-800 focus:outline-none focus:ring-2 focus:ring-white shadow-lg">
                    <button class="bg-white text-blue-600 font-semibold py-3 px-6 rounded-xl hover:bg-blue-50 transition duration-300 transform hover:-translate-y-1 shadow-lg">
                        Subscribe
                    </button>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Auto-submit form when select fields change
        const autoSubmitFields = document.querySelectorAll('select[name="category"], select[name="sort"], input[name="date"]');
        autoSubmitFields.forEach(field => {
            field.addEventListener('change', function() {
                this.form.submit();
            });
        });

        // Location button functionality
        const locationBtn = document.getElementById('location-btn');
        if (locationBtn) {
            locationBtn.addEventListener('click', function() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        function(position) {
                            // You can implement location-based filtering here
                            alert('Location detected! Implementing location-based filtering...');
                        },
                        function(error) {
                            alert('Unable to get your location. Please enable location services.');
                        }
                    );
                } else {
                    alert('Geolocation is not supported by your browser.');
                }
            });
        }

        // Add loading state to form submission
        const form = document.querySelector('form');
        if (form) {
            form.addEventListener('submit', function() {
                const submitBtn = this.querySelector('button[type="submit"]');
                if (submitBtn) {
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Searching...';
                    submitBtn.disabled = true;
                }
            });
        }
    });
</script>

<style>
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .line-clamp-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    /* Smooth scrolling for the entire page */
    html {
        scroll-behavior: smooth;
    }

    /* Custom scrollbar for select elements */
    select::-webkit-scrollbar {
        width: 8px;
    }
    
    select::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
    }
    
    select::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 4px;
    }
    
    select::-webkit-scrollbar-thumb:hover {
        background: #a8a8a8;
    }
    
    /* Enhanced focus styles */
    input:focus, select:focus {
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
</style>

{% endblock %}